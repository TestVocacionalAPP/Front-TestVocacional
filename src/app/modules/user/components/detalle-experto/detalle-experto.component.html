<div class="container mt-4" *ngIf="experto">
  <button mat-button (click)="goBack()" class="mb-3">
    <mat-icon>arrow_back</mat-icon> Volver
  </button>

  <mat-card>
    <mat-card-header class="text-center">
      <!-- Imagen del experto -->
      <ng-container *ngIf="experto.imagenBase64; else sinImagen">
        <img
          [src]="formatImageUrl(experto.imagenBase64)"
          alt="Imagen del experto"
          class="rounded-circle border border-dark"
          width="150"
          height="150"
        >
      </ng-container>
      <ng-template #sinImagen>
        <div class="placeholder-image rounded-circle border border-dark d-flex align-items-center justify-content-center" style="width: 150px; height: 150px;">
          <span>Sin imagen</span>
        </div>
      </ng-template>
    </mat-card-header>

    <!-- Contenido del perfil del experto -->
    <mat-card-content>
      <div class="text-center mt-3">
        <mat-card-title>{{ experto.nombre }} {{ experto.apellido }}</mat-card-title>
        <mat-card-subtitle>{{ experto.especialidad }}</mat-card-subtitle>
      </div>
      <div class="mt-3">
        <p><strong>Descripción:</strong></p>
        <p>{{ experto.descripcion }}</p>
      </div>
    </mat-card-content>

    <!-- Acciones -->
    <mat-card-actions>
      <button mat-raised-button color="primary" (click)="contactarExperto(experto)">Contactar</button>
      <button mat-icon-button (click)="incrementarLikes()">
        <mat-icon aria-label="Like" [ngClass]="{ 'liked': isLiked }">thumb_up</mat-icon>
      </button>
      <span>{{ experto.likes || 0 }} likes</span>
    </mat-card-actions>
  </mat-card>

  <!-- Sección de comentarios -->
  <div class="mt-4">
    <h4>Comentarios</h4>
    <div class="mt-3 d-flex align-items-start">
      <textarea [(ngModel)]="nuevoComentario" class="form-control me-2" placeholder="Escribe un comentario"></textarea>
      <button class="btn btn-primary" (click)="agregarComentario()">Agregar comentario</button>
    </div>

    <div *ngFor="let comentario of comentarios" class="mt-3 p-3 border rounded">
      <strong>{{ comentario.nombreUsuario }} {{ comentario.apellidoUsuario }}</strong>
      <p>{{ comentario.contenido }}</p>
      <small class="text-muted">{{ comentario.fecha | date:'short' }}</small>

      <!-- Botones de Editar y Eliminar -->
      <div class="mt-2 d-flex justify-content-end">
        <div *ngIf="comentario.esUsuarioAutenticado" class="mt-2">
          <button class="btn btn-sm btn-warning me-2" (click)="editarComentario(comentario)">Editar</button>
          <button class="btn btn-sm btn-danger" (click)="eliminarComentario(comentario.id)">Eliminar</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="!experto" class="alert alert-warning mt-4">
  No se encontraron detalles para este experto.
</div>
